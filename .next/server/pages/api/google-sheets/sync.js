"use strict";(()=>{var e={};e.id=780,e.ids=[780],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},9993:e=>{e.exports=require("googleapis")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},1576:(e,t,r)=>{r.r(t),r.d(t,{config:()=>h,default:()=>_,routeModule:()=>b});var o={};r.r(o),r.d(o,{default:()=>g});var n=r(1802),s=r(7153),a=r(6249),i=r(2885),l=r(9993);let u=JSON.parse('{"type":"service_account","project_id":"go-blinds-smart-system","private_key_id":"9528d04e357fd7ba08bd1532e6935a6fc3859f4d","private_key":"-----BEGIN PRIVATE KEY-----\\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCzvkMWwrF1Fgjq\\n//2Ca2pEuvVxmk+0JPxYCH9wZOXBA5wrqlV0EdNmifPRqie7FGvAkJjc/TTonJDk\\ntEf7bs5OTM59BQWatH+sqXBWP+6QLppzsnYQP1YnXGw+LMa/loMR7RMCOPCmTahB\\nvZQG7m+9QFZFI+vjWK2eDTa+K/EnJJ6+d8JWx8PfH3+a4dj7HNPnevx4LVZYYpTy\\nFktEJUkMmh7ZpJ1LA48FJ+03Ucw2gC0fVDkGe8ep1q4vBjoiFz8KTYOWdtkaNrpc\\nP8iM9V/Qu3/HzH19zVSeBu5iqyTawJdsuBhhkVR7Fq0J9GkQj3FccID6XWdINXrK\\nk7/4WbjlAgMBAAECggEAE+o0ejjbmxa0Kb9vuevHVDKnv6zCgHnpmKJmZlBTkXli\\nLAddHPVdqBqIUHZrHQQD9UvAGBoY6t3wAtsDr7TE+HFznm/4QT4W+E00tGW0e7ai\\nJ8gB40Z1N/q6RoBFDBSz1IBhLwmahj6L8i68UDFKYZxXgqUafW/FmsGpi1QIjdbF\\n7TPE0i6FJz5BoOD+nNZpSGUaNqXg6uj2lKdE8Fed22r5HSdTXXMV76kasrqXWuHc\\nd0k4PxJRQmQMN2+Lyqp3kJ68UyrJNxZee+135yKb5NEywIJbFXB27YrUhz/ARoDj\\njY4lAq/tM+AiPyKstIX1Pe23wKS+3ocwofk3GdqcUQKBgQDoW1XEIJZSIfZr9xRg\\nN0yvrvRYVvCKGz2hloAufBDpjfR4kdMVWWL6wu9q6CGrfop5kGt+0UucIsjGufp+\\nNl7H7R/L2+DL3jkAzp5fcN8DZrVWv5J6IbtdXXFU3mM31x+HzjFOFssLZmgIW1gj\\nL2n7NViK70+NdagCiF+jQzep1QKBgQDGCGVASpOVjKJelGsDCNxBoX6tqFw8FgPI\\nwYrKyCXsXcAv5X4dk6MxLD8JSpp29G7l46g3nFFFsE9qBKsFE9vak2yZGpwaKPV7\\nNfgTLeQaYgkRAcViWrhOfftWDWFaZQafJ93gzMgs76bkPQ4H6STDw1/bzNz8cVME\\n4PcOOU7K0QKBgE/2rstyU4ksevuo6nA6V7/WO+zy7pD40vr7Kl3VAJT/73RW6wfb\\n3T5jO7XU8VFtmQZA912LdbPkHKiXdGdfGrs/FcQ4hWJjtcZbVRGPbJBlFl8mSqiR\\nV0PIVqpYZljfRdCc20b+fR4NPhwyI2Doflafgzs9JGmQZiOI/zDWfx+JAoGAE+OH\\n97sFs4FaVVFmpflf1Z+Yj2xXRxmW67S0ccVEOcb4pFbSIbpQK4IcGpzJgqTt9ly0\\n6lDiwLMCZs1tN6dU71DbGU1Y3C+859D1x0dWn2e1LWYWItilpgx1D6FsY5292oIw\\ngIFQoWK4Sjfvjs/Vh2u51uNuVlQzWEwXw+/xf+ECgYB/jAqXqfGqGX7XHUhADJwI\\nwnsmsT2JultIcL3hUbF5vDXZgToIuDBHW8ms64JwH0IS6kvfhx3Z81N+6fbKghv4\\nvq4fIU/lWSgz2mSK9NSh3HIPWptRckt2LGAl9Sr9Sltg5o43eF0Al8qXIdMSLueO\\nrY9VoN9FkcEeb00NvC0+cA==\\n-----END PRIVATE KEY-----\\n","client_email":"go-blinds-sheet-reader@go-blinds-smart-system.iam.gserviceaccount.com","client_id":"108405195208942249207","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url":"https://www.googleapis.com/robot/v1/metadata/x509/go-blinds-sheet-reader%40go-blinds-smart-system.iam.gserviceaccount.com","universe_domain":"googleapis.com"}');var d=r(3884),c=r(5290);let p=(0,i.createClient)("https://xrqbldnqjmyjnurlwvlt.supabase.co","sb_publishable_QEAQo0wNojYKriWfnyvfbQ_r8Cc1s37"),m=e=>{if(!e)return null;let t=e.split("/");if(3===t.length){let[e,r,o]=t.map(e=>parseInt(e,10));return`${o<100?2e3+o:o}-${String(e).padStart(2,"0")}-${String(r).padStart(2,"0")}`}return null};async function f(e,t){let r={},o={"Customer Name":"customer_name","Work Order Number":"work_order_number","PO Number":"po_number","Phone 1":"phone_1","Phone 2":"phone_2","Phone 3":"phone_3",Email:"email",Address:"address","Apt / Unit Number":"apt_unit_number",City:"city",State:"state","Zip Code":"zip_code","Store Number":"store_number","Job Type":"job_type",Instructions:"instructions",Materials:"materials","Time Window":"time_window","Last Note Made":"last_note_made","Latest Comment":"latest_comment"};for(let n of e){let e={};t.forEach((t,r)=>{e[t]=n[r]||null});let s=e["Work Order Number"];if(!s)continue;if(!r[s]){let t={};for(let r in o)t[o[r]]=e[r]||null;t.entry_date=m(e["Entry Date"]),t.date_order_sent_to_installer=m(e["Date order sent to installer"]),t.material_arrival_date=m(e["Material Arrival Date"]),t.schedule_date=m(e["Schedule Date"]),t.labor_to_do_items=[],r[s]=t}let a=e["Labor To Do"];a&&"string"==typeof a&&""!==a.trim()&&r[s].labor_to_do_items.push(a)}let n=0;for(let e in r){let t=r[e];t.labor_to_do=t.labor_to_do_items.join("\n"),delete t.labor_to_do_items,t.line_items=(0,d.F)(t.labor_to_do||"");let{durationMinutes:o,quote:s}=await (0,c.D)(t.line_items);t.duration_minutes=o,t.quote=s;let{error:a}=await p.from("customer_orders").upsert(t,{onConflict:"work_order_number"});a?console.error("Supabase upsert error for WO#",e,":",a.message):n++}return{processedCount:n}}async function g(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let e=new l.google.auth.GoogleAuth({credentials:u,scopes:["https://www.googleapis.com/auth/spreadsheets.readonly"]}),r=l.google.sheets({version:"v4",auth:e}),o=(await r.spreadsheets.values.get({spreadsheetId:process.env.GOOGLE_SHEET_ID,range:"Ezra Dorsey"})).data.values;if(!o||0===o.length)return t.status(200).json({message:"No data found in sheet."});let n=o.shift();if(!n)return t.status(200).json({message:"Sheet is empty or missing a header row."});let{processedCount:s}=await f(o,n);return t.status(200).json({message:`Sync complete. Processed ${o.length+1} rows and upserted ${s} unique orders.`})}catch(e){return console.error("Error during Google Sheets sync:",e.message),t.status(500).json({error:"Google Sheets sync failed.",details:e.message})}}let _=(0,a.l)(o,"default"),h=(0,a.l)(o,"config"),b=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/google-sheets/sync",pathname:"/api/google-sheets/sync",bundlePath:"",filename:""},userland:o})},5290:(e,t,r)=>{r.d(t,{D:()=>i,p:()=>a});var o=r(3884),n=r(3245);async function s(){let{data:e,error:t}=await n.O.from("line_item_catalog").select("*").eq("active",!0);return t?(console.error("Supabase fetch error:",t),[]):e||[]}async function a(e){let t=(0,o.F)(e);if(!t.length)return 0;let r=await s();if(!r.length)return 0;let n=0;for(let e of t){let t=r.find(t=>e.description.toLowerCase().includes(t.code.toLowerCase()));t&&(n+=t.duration_minutes*e.quantity)}return n}async function i(e){let t=0,r=[],o=await s();if(!o.length)return{durationMinutes:0,quote:0,unknownLineItems:e};let n=0;for(let s of e){let e=o.find(e=>s.description.toLowerCase().includes(e.code.toLowerCase()));e?(n+=e.duration_minutes*s.quantity,t+=Number(e.price)*s.quantity):r.push(s)}return{durationMinutes:n,quote:t,unknownLineItems:r}}},3884:(e,t,r)=>{r.d(t,{F:()=>o});function o(e){return e?e.split(/\r?\n/).map(e=>e.trim()).filter(Boolean).map(e=>{let t=e.match(/Qty: ([\d.]+) - (.+)/i);return t?{quantity:parseFloat(t[1]),description:t[2].trim()}:null}).filter(Boolean):[]}},3245:(e,t,r)=>{r.d(t,{O:()=>a});var o=r(2885);let n="https://xrqbldnqjmyjnurlwvlt.supabase.co",s="sb_publishable_QEAQo0wNojYKriWfnyvfbQ_r8Cc1s37";if(!n||!s)throw Error("Supabase URL and anonymous key are required.");let a=(0,o.createClient)(n,s)},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=1576);module.exports=r})();