"use strict";(()=>{var e={};e.id=780,e.ids=[780],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},9993:e=>{e.exports=require("googleapis")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},1576:(e,t,o)=>{o.r(t),o.d(t,{config:()=>h,default:()=>m,routeModule:()=>b});var r={};o.r(r),o.d(r,{default:()=>f});var n=o(1802),s=o(7153),a=o(6249),i=o(2885),l=o(9993);let u=JSON.parse('{"type":"service_account","project_id":"go-blinds-smart-system","private_key_id":"9528d04e357fd7ba08bd1532e6935a6fc3859f4d","private_key":"-----BEGIN PRIVATE KEY-----\\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCzvkMWwrF1Fgjq\\n//2Ca2pEuvVxmk+0JPxYCH9wZOXBA5wrqlV0EdNmifPRqie7FGvAkJjc/TTonJDk\\ntEf7bs5OTM59BQWatH+sqXBWP+6QLppzsnYQP1YnXGw+LMa/loMR7RMCOPCmTahB\\nvZQG7m+9QFZFI+vjWK2eDTa+K/EnJJ6+d8JWx8PfH3+a4dj7HNPnevx4LVZYYpTy\\nFktEJUkMmh7ZpJ1LA48FJ+03Ucw2gC0fVDkGe8ep1q4vBjoiFz8KTYOWdtkaNrpc\\nP8iM9V/Qu3/HzH19zVSeBu5iqyTawJdsuBhhkVR7Fq0J9GkQj3FccID6XWdINXrK\\nk7/4WbjlAgMBAAECggEAE+o0ejjbmxa0Kb9vuevHVDKnv6zCgHnpmKJmZlBTkXli\\nLAddHPVdqBqIUHZrHQQD9UvAGBoY6t3wAtsDr7TE+HFznm/4QT4W+E00tGW0e7ai\\nJ8gB40Z1N/q6RoBFDBSz1IBhLwmahj6L8i68UDFKYZxXgqUafW/FmsGpi1QIjdbF\\n7TPE0i6FJz5BoOD+nNZpSGUaNqXg6uj2lKdE8Fed22r5HSdTXXMV76kasrqXWuHc\\nd0k4PxJRQmQMN2+Lyqp3kJ68UyrJNxZee+135yKb5NEywIJbFXB27YrUhz/ARoDj\\njY4lAq/tM+AiPyKstIX1Pe23wKS+3ocwofk3GdqcUQKBgQDoW1XEIJZSIfZr9xRg\\nN0yvrvRYVvCKGz2hloAufBDpjfR4kdMVWWL6wu9q6CGrfop5kGt+0UucIsjGufp+\\nNl7H7R/L2+DL3jkAzp5fcN8DZrVWv5J6IbtdXXFU3mM31x+HzjFOFssLZmgIW1gj\\nL2n7NViK70+NdagCiF+jQzep1QKBgQDGCGVASpOVjKJelGsDCNxBoX6tqFw8FgPI\\nwYrKyCXsXcAv5X4dk6MxLD8JSpp29G7l46g3nFFFsE9qBKsFE9vak2yZGpwaKPV7\\nNfgTLeQaYgkRAcViWrhOfftWDWFaZQafJ93gzMgs76bkPQ4H6STDw1/bzNz8cVME\\n4PcOOU7K0QKBgE/2rstyU4ksevuo6nA6V7/WO+zy7pD40vr7Kl3VAJT/73RW6wfb\\n3T5jO7XU8VFtmQZA912LdbPkHKiXdGdfGrs/FcQ4hWJjtcZbVRGPbJBlFl8mSqiR\\nV0PIVqpYZljfRdCc20b+fR4NPhwyI2Doflafgzs9JGmQZiOI/zDWfx+JAoGAE+OH\\n97sFs4FaVVFmpflf1Z+Yj2xXRxmW67S0ccVEOcb4pFbSIbpQK4IcGpzJgqTt9ly0\\n6lDiwLMCZs1tN6dU71DbGU1Y3C+859D1x0dWn2e1LWYWItilpgx1D6FsY5292oIw\\ngIFQoWK4Sjfvjs/Vh2u51uNuVlQzWEwXw+/xf+ECgYB/jAqXqfGqGX7XHUhADJwI\\nwnsmsT2JultIcL3hUbF5vDXZgToIuDBHW8ms64JwH0IS6kvfhx3Z81N+6fbKghv4\\nvq4fIU/lWSgz2mSK9NSh3HIPWptRckt2LGAl9Sr9Sltg5o43eF0Al8qXIdMSLueO\\nrY9VoN9FkcEeb00NvC0+cA==\\n-----END PRIVATE KEY-----\\n","client_email":"go-blinds-sheet-reader@go-blinds-smart-system.iam.gserviceaccount.com","client_id":"108405195208942249207","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url":"https://www.googleapis.com/robot/v1/metadata/x509/go-blinds-sheet-reader%40go-blinds-smart-system.iam.gserviceaccount.com","universe_domain":"googleapis.com"}');var d=o(3884),c=o(5290);let g=(0,i.createClient)("https://xrqbldnqjmyjnurlwvlt.supabase.co","sb_publishable_QEAQo0wNojYKriWfnyvfbQ_r8Cc1s37");async function p(e,t){let o={},r={header:t,firstRow:e.length>0?e[0]:null};for(let r of e){let e={};t.forEach((t,o)=>{e[t]=r[o]||null});let n=e["Work Order Number"];if(!n){console.warn("Skipping row without a work order number:",r);continue}o[n]||(o[n]={entry_date:e["Entry Date"],customer_name:e["Customer Name"],work_order_number:n,po_number:e["PO Number"],phone_1:e["Phone 1"],email:e.Email,address:e.Address,city:e.City,state:e.State,zip_code:e["Zip Code"],labor_to_do_items:[]}),e["Labor To Do"]&&o[n].labor_to_do_items.push(e["Labor To Do"])}let n=0;for(let e in o){let t=o[e];t.labor_to_do=t.labor_to_do_items.join("\n"),delete t.labor_to_do_items,t.line_items=(0,d.F)(t.labor_to_do||"");let{durationMinutes:r,quote:s}=await (0,c.D)(t.line_items);t.duration_minutes=r,t.quote=s;let{error:a}=await g.from("customer_orders").upsert(t,{onConflict:"work_order_number"});a?console.error("Supabase upsert error for WO#",e,":",a.message):(console.log("Successfully upserted aggregated data for WO#",e),n++)}return{processedCount:n,debugData:r}}async function f(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let e=new l.google.auth.GoogleAuth({credentials:u,scopes:["https://www.googleapis.com/auth/spreadsheets.readonly"]}),o=l.google.sheets({version:"v4",auth:e}),r=(await o.spreadsheets.values.get({spreadsheetId:process.env.GOOGLE_SHEET_ID,range:"Ezra Dorsey"})).data.values;if(!r||0===r.length)return t.status(200).json({message:"No data found in sheet."});let n=r.shift();if(!n)return t.status(200).json({message:"Sheet is empty or missing a header row."});if(console.log("DEBUG: Header row received from Google Sheets:",n),r.length>0){let e={};n.forEach((t,o)=>{e[t]=r[0][o]||null}),console.log("DEBUG: Parsed data from first row:",e)}console.log(`Found ${r.length} rows to aggregate.`);let{processedCount:s,debugData:a}=await p(r,n);return t.status(200).json({message:`Sync complete. Processed ${r.length} rows and upserted ${s} unique orders.`,debug:a})}catch(e){return console.error("Error during Google Sheets sync:",e.message),t.status(500).json({error:"Google Sheets sync failed.",details:e.message})}}let m=(0,a.l)(r,"default"),h=(0,a.l)(r,"config"),b=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/google-sheets/sync",pathname:"/api/google-sheets/sync",bundlePath:"",filename:""},userland:r})},5290:(e,t,o)=>{o.d(t,{D:()=>i,p:()=>a});var r=o(3884),n=o(3245);async function s(){let{data:e,error:t}=await n.O.from("line_item_catalog").select("*").eq("active",!0);return t?(console.error("Supabase fetch error:",t),[]):e||[]}async function a(e){let t=(0,r.F)(e);if(!t.length)return 0;let o=await s();if(!o.length)return 0;let n=0;for(let e of t){let t=o.find(t=>e.description.toLowerCase().includes(t.code.toLowerCase()));t&&(n+=t.duration_minutes*e.quantity)}return n}async function i(e){let t=0,o=[],r=await s();if(!r.length)return{durationMinutes:0,quote:0,unknownLineItems:e};let n=0;for(let s of e){let e=r.find(e=>s.description.toLowerCase().includes(e.code.toLowerCase()));e?(n+=e.duration_minutes*s.quantity,t+=Number(e.price)*s.quantity):o.push(s)}return{durationMinutes:n,quote:t,unknownLineItems:o}}},3884:(e,t,o)=>{o.d(t,{F:()=>r});function r(e){return e?e.split(/\r?\n/).map(e=>e.trim()).filter(Boolean).map(e=>{let t=e.match(/Qty: ([\d.]+) - (.+)/i);return t?{quantity:parseFloat(t[1]),description:t[2].trim()}:null}).filter(Boolean):[]}},3245:(e,t,o)=>{o.d(t,{O:()=>a});var r=o(2885);let n="https://xrqbldnqjmyjnurlwvlt.supabase.co",s="sb_publishable_QEAQo0wNojYKriWfnyvfbQ_r8Cc1s37";if(!n||!s)throw Error("Supabase URL and anonymous key are required.");let a=(0,r.createClient)(n,s)},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var o=t(t.s=1576);module.exports=o})();